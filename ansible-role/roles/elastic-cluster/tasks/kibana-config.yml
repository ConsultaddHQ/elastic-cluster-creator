---
- name: Install Kibana
  apt: 
    name: kibana={{ elk_version }}
    state: present
  register: install_output
  when: "'elasticsearch_kibana' in group_names"

- name: "Update kibana.yaml file"
  template: 
    src: kibana.yml
    dest: /etc/kibana/kibana.yml

- name: Enable and Start kibana
  ansible.builtin.service:
    name: kibana
    enabled: yes
    state: started
  when: "'elasticsearch_kibana' in group_names"

- name: Generating kibana verification code
  shell: |
    /usr/share/kibana/bin/kibana-verification-code 
  register: kibana_verification_code
  when: "'elasticsearch_kibana' in group_names"

- name: "Printing kibana verification code"
  debug: var=kibana_verification_code.stdout
  when: "'elasticsearch_kibana' in group_names"